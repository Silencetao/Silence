<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.silencetao.dao.technical.TechnicalDao">
	<insert id="insertTechnical">
		INSERT INTO technical(title, content, publisher, technical_sign, audit_status, 
		home_show, classify, summary) VALUES(#{title}, #{content}, #{publisher}, #{technicalSign},
		#{auditStatus}, #{homeShow}, #{classify}, #{summary})
	</insert>
	
	<select id="getTechnicals" resultType="com.silencetao.view.EssayView">
		SELECT technical_id essay_id, title, content, technical_sign essay_sign, 
		publish_time, audit_status, home_show, classify, summary, comment_num, visitor_num, 
		praise_num, nikename, header,
		(SELECT real_path FROM picture WHERE pertain = technical_sign LIMIT 1) cover 
		FROM technical LEFT JOIN statistic ON statistic.pertain = technical_sign 
		LEFT JOIN USER ON USER.user_sign = publisher
		ORDER BY publish_time DESC LIMIT #{offset}, #{limit}
	</select>
	
	<select id="getTechnicalNum" resultType="java.lang.Long">
		SELECT COUNT(1) FROM technical
	</select>
	
	<select id="getTechnicalById" resultType="com.silencetao.view.EssayView">
		SELECT technical_id essay_id, title, content, technical_sign essay_sign, 
		publish_time, audit_status, home_show, classify, comment_num, visitor_num, 
		praise_num,	nikename, header, summary FROM technical LEFT JOIN statistic ON 
		statistic.pertain = technical_sign LEFT JOIN USER ON USER.user_sign = publisher
		WHERE technical_id = #{technicalId}
	</select>
	
	<select id="getOpinionFront" resultType="com.silencetao.view.EssayView">
		<![CDATA[ SELECT technical_id essay_id, title FROM technical WHERE technical_id > #{technicalId} ORDER BY 
		publish_time LIMIT 1 ]]>
	</select>
	
	<select id="getOpinionAfter" resultType="com.silencetao.view.EssayView">
		<![CDATA[ SELECT technical_id essay_id, title FROM technical WHERE technical_id < #{technicalId} ORDER BY 
		publish_time DESC LIMIT 1 ]]>
	</select>
	
	<select id="getTechnicalHome" resultType="com.silencetao.view.EssayView">
		SELECT technical_id essay_id, title, publish_time, classify, summary, nikename, 
		header,	(SELECT real_path FROM picture WHERE pertain = technical_sign LIMIT 1) cover 
		FROM technical LEFT JOIN statistic ON statistic.pertain = technical_sign 
		LEFT JOIN USER ON USER.user_sign = publisher WHERE home_show = 1
		ORDER BY publish_time DESC LIMIT 0, 4
	</select>
	
	<update id="updateHomeShow">
		UPDATE technical SET home_show = #{homeShow} WHERE technical_sign = #{technicalSign}
	</update>
</mapper>